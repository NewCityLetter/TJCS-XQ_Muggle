# **TJCS-19 XQ_Muggle**

---
**同济大学2021年人工智能荣誉课课设-象棋AI-XQ_Muggle**

## 小组成员

组长：屈靖恩

组员：高琰婷 罗格峰

## 项目限制

方法限制：搜索剪枝模型。

时间限制：单步60s

内存限制：4G

## 算法

搜索部分：以主要变例搜索（PVS）、零窗口裁剪搜索（SearchCut）、静态搜索（QuiescSearch）为主体，将根节点（RootSearch）搜索单独分离。

棋盘部分：使用主流16*16的一维数组棋盘表示法，方便对棋子进行位运算取值。同时使用BitCol/BitLine两个数组分别记录下列位棋盘、行位棋盘，以方便车、炮着法生产。

着法生成部分：对于普通棋子如士、象、马等采用普通的着法生成，将其于每个位置的着法预生成储存于数组之中，而车、炮则通过位列生成器生成，使用一个32位的整数表示每列、每行的所有状态，通过位运算大大减少车、炮着法生成时间。

估值部分：采用根据子力进行判断的预估值算法，在每个局面先检测当前局面红黑方子力，然后根据子力计算出中局值，由此来根据预先存入的开局子力表和残局子力表来生成最适合于当前局势的子力价值表。

开局库：受限于本次作业要求，最终开局库选择了大小合适的“华弈开局库V20190501”开局库，去除重复局面后其中包含六十万条初始局面的最优解法。

## 成果

XQ_Muggle_release.exe

单步搜索三秒钟，静态搜索六十四层情况下，开局深度可达到普通搜索九层，中局深度可到到十二到十三层，残局深度可达到二十层或是搜满最大深度三十二层。

## 创新

理解象棋巫师发现其根节点并未采用任何启发算法，而是单纯的预生成着法进行搜索。在象棋麻瓜中，对于根节点的着法也进行了置换启发、杀手启发。根据测试，在不影响最终搜索结果的基础上，有效的将相同局面相同深度搜索时间缩短了一半以上。

## 缺陷

在象棋麻瓜release版本中，几乎包含了所有的已知免费软件的算法。其搜索深度也较深，但是其棋力并没有符合其搜索深度应该有的表现。可能是仍然有一些微小的bug影响了全局的效果，也有可能是子力价值表的表现并非很好。因为象棋麻瓜几乎是在象棋巫师的子力价值表上进行编写的，而象棋巫师也在自己的说明文档中承认了自己的子力价值表是一大缺陷。

## 参考资料网址

 [象棋百科全书-计算机博弈](https://www.xqbase.com/computer.htm)

 [引擎介绍及源代码](https://www.techgrow.cn/posts/26ffa5e3.html)

 [位棋盘、negascout](https://github.com/pengjiu/ChineseChess)

## 图形化界面

 [可加载对弈（需关闭defence）](https://exp.newsmth.net/topic/ed55126a4bc9831c6b148f8c47800fad)

## 代码规范
>变量名小驼峰，静态变量使用大驼峰

>函数名大驼峰，位操作及取指函数全部大写

>.h文件头注意使用#ifndef XXX_H #define XXX_H，文件末#endif，防止头文件多次编译

